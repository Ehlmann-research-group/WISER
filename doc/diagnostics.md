# Diagnostics (working document)

This document contains a collection of snippets and techniques to diagnose bugs
and performance issues in Python programs.

## Debug Seg-Faults in Python

Some libraries, like Qt PySide2 and GDAL, are Python bindings for C/C++ code.
This means it is very possible to generate SIGSEGVs and other faults from buggy
Python code.  To diagnose the cause of such faults, use the built-in Python
[faulthandler](https://docs.python.org/3/library/faulthandler.html) module.

    import faulthandler

    # At the start of the program, do this:
    faulthandler.enable()

When faults occur, you will get a nice Python stack trace.  If you're lucky,
the stack trace will show you exactly what the problem is.

## Profile a Python Program

To run the Python [cProfile]() profiler on `program.py`, storing the profile
data into a file `profile_stats`:

    python -m cProfile -o profile_stats program.py

### Dump Profile Data

To load the `profile_stats` file generated by the previous command, and

    import pstats
    from pstats import SortKey
    p = pstats.Stats('profile_stats')

    # Sort by total time spent in each function's code
    p.strip_dirs().sort_stats(SortKey.TIME).print_stats(40)

    # Sort by the cumulative time spent in each function and what it calls
    p.strip_dirs().sort_stats(SortKey.CUMULATIVE).print_stats(40)

## Programatically List All Installed Packages with Versions

To list all installed packages and their working versions:

    import pkg_resources
    installed_packages = [(d.project_name, d.version) for d in pkg_resources.working_set]

This will
