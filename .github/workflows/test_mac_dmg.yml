name: Mount and Run WISER

on:
  workflow_dispatch:
  push:

jobs:
  run-wiser:
    runs-on: macos-latest
    env:
      DMG_URL: https://onedrive.live.com/personal/ca5453510e2c3763/_layouts/15/download.aspx?SourceUrl=%2Fpersonal%2Fca5453510e2c3763%2FDocuments%2FWISER%2DIntel%2FWISER%2D1%2E2b1%2Dintel%2Edmg
      VOLUME_NAME: WISER
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Download DMG
        run: |
          echo "Downloading DMG from OneDrive..."
          curl -L "$DMG_URL" -o wiser.dmg

      - name: Mount DMG
        run: |
          echo "Mounting disk image..."
          hdiutil attach wiser.dmg -nobrowse -mountpoint /Volumes/$VOLUME_NAME

      - name: Run WISER binary
        run: |
          echo "Running WISER_Bin..."
          /Volumes/$VOLUME_NAME/Contents/MacOS/WISER_Bin

      - name: Detach DMG
        if: always()
        run: |
          echo "Detaching disk image..."
          hdiutil detach /Volumes/$VOLUME_NAME
